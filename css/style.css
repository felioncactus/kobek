:root {
  --pink-1: #ffb3da;
  --pink-2: #ff7fc6;
  --pink-3: #ffb0ef;
  --pink-4: #ffd1f7;
  --pink-5: #ffc0dd;

  --paper: #fffafc;
  --paper-2: #fff2f7;

  --ink: rgba(30, 18, 24, 0.92);

  --red: #ff4b4b;
  --blue: #2f7dff;

  --shadow: 0 20px 70px rgba(0,0,0,0.18);
  --shadow-soft: 0 10px 30px rgba(0,0,0,0.16);

  --radius: 22px;
  --ease: cubic-bezier(.2,.85,.2,1);

  --sat: env(safe-area-inset-top, 0px);
  --sar: env(safe-area-inset-right, 0px);
  --sab: env(safe-area-inset-bottom, 0px);
  --sal: env(safe-area-inset-left, 0px);

  --glitter: rgba(255,255,255,0.85);
  --sticker-pink: rgba(255, 120, 210, 0.22);
  --sticker-blue: rgba(120, 175, 255, 0.18);

  --msg-line-height: 1.65;
  --msg-line-step: calc(var(--msg-line-height) * 1em);

  /* NEW: single font everywhere */
  --font-all: "Comic Relief", ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
}

* { box-sizing: border-box; }
html, body { height: 100%; }

body {
  margin: 0;
  font-family: var(--font-all);
  color: var(--ink);
  overflow-x: hidden;

  background: linear-gradient(120deg, var(--pink-1), var(--pink-2), var(--pink-3), var(--pink-4), var(--pink-5));
  background-size: 800% 800%;
  animation: bgShift 7.2s var(--ease) infinite;
}

body::before {
  content: "";
  position: fixed;
  inset: -25%;
  pointer-events: none;
  z-index: -2;

  background:
    radial-gradient(closest-side at 20% 25%, rgba(255, 255, 255, 0.60), rgba(255,255,255,0) 62%),
    radial-gradient(closest-side at 80% 40%, rgba(255, 140, 210, 0.62), rgba(255,255,255,0) 64%),
    radial-gradient(closest-side at 55% 85%, rgba(255, 120, 235, 0.58), rgba(255,255,255,0) 62%),
    radial-gradient(closest-side at 45% 55%, rgba(150, 190, 255, 0.25), rgba(255,255,255,0) 64%);
  filter: blur(26px) saturate(1.55);
  mix-blend-mode: screen;
  opacity: 0.92;

  animation: bgGlow 6.2s var(--ease) infinite;
  transform: translateZ(0);
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: -1;
  opacity: 0.12;
  background-image:
    radial-gradient(circle at 15% 20%, rgba(255,255,255,0.9) 0 1px, transparent 2px),
    radial-gradient(circle at 55% 40%, rgba(255,255,255,0.8) 0 1px, transparent 2px),
    radial-gradient(circle at 75% 70%, rgba(255,255,255,0.85) 0 1px, transparent 2px),
    radial-gradient(circle at 30% 80%, rgba(255,255,255,0.85) 0 1px, transparent 2px);
  background-size: 160px 160px;
  animation: sparkleDrift 10s linear infinite;
}

@keyframes bgShift {
  0%   { background-position: 0% 50%; }
  50%  { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

@keyframes bgGlow {
  0%   { transform: translate(-3%, -2%) scale(1.03); filter: blur(24px) saturate(1.55) hue-rotate(0deg); }
  50%  { transform: translate(3%, 2%) scale(1.10);  filter: blur(30px) saturate(1.85) hue-rotate(22deg); }
  100% { transform: translate(-3%, -2%) scale(1.03); filter: blur(24px) saturate(1.55) hue-rotate(0deg); }
}

@keyframes sparkleDrift {
  0%   { transform: translate3d(0,0,0); }
  100% { transform: translate3d(-120px, 60px, 0); }
}

/* Background dim overlay */
.bg-dim {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.28);
  opacity: 0;
  transition: opacity 420ms var(--ease);
  pointer-events: none;
  z-index: 1;
}
.bg-dim.is-on { opacity: 1; pointer-events: auto; }

.page {
  min-height: 100%;
  display: grid;
  place-items: center;
  padding: 18px;
  position: relative;
  z-index: 2;
}

.stage {
  width: min(420px, 100%);
  display: grid;
  place-items: center;
  gap: 14px;
}

.hint {
  margin: 0;
  font-size: 14px;
  opacity: 0.86;
  user-select: none;
}

.envelope-btn {
  width: 100%;
  border: 0;
  background: transparent;
  padding: 0;
  cursor: pointer;
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
}

.envelope-btn:focus-visible {
  outline: 3px solid rgba(255, 75, 120, 0.45);
  outline-offset: 8px;
  border-radius: 20px;
}

/* Envelope container (NO transform here) */
.envelope {
  position: relative;
  width: 100%;
  aspect-ratio: 16 / 11;
  max-height: 340px;
  border-radius: var(--radius);
  will-change: transform;
}

.shadow {
  position: absolute;
  inset: auto 8% -10% 8%;
  height: 22%;
  background: radial-gradient(closest-side, rgba(0,0,0,0.22), rgba(0,0,0,0));
  filter: blur(6px);
  transform: translateY(10px);
  opacity: 0.75;
  pointer-events: none;
}

.airmail-border {
  position: absolute;
  inset: 0;
  border-radius: var(--radius);
  padding: 9px;
  background:
    repeating-linear-gradient(
      45deg,
      var(--red) 0 10px,
      #ffffff 10px 20px,
      var(--blue) 20px 30px,
      #ffffff 30px 40px
    );
  box-shadow: var(--shadow);
}

.envelope-back {
  position: absolute;
  inset: 9px;
  border-radius: calc(var(--radius) - 9px);
  background: linear-gradient(180deg, #ffffff, #fff3f7);
  overflow: hidden;
}

.envelope-front {
  position: absolute;
  inset: 9px;
  border-radius: calc(var(--radius) - 9px);
  overflow: hidden;
  pointer-events: none;
}

.front-paper {
  position: absolute;
  inset: 0;
  background:
    radial-gradient(900px 300px at 25% -30%, rgba(255, 171, 210, 0.35), rgba(255,255,255,0)),
    linear-gradient(180deg, #ffffff, #fff0f6);
  border-radius: calc(var(--radius) - 9px);
  box-shadow: inset 0 -1px 0 rgba(0,0,0,0.06);
}

.address {
  position: absolute;
  left: 8%;
  bottom: 16%;
  width: 56%;
  display: grid;
  gap: 8px;
  opacity: 0.65;
}

.addr-line {
  height: 10px;
  border-radius: 999px;
  background: rgba(20, 10, 14, 0.10);
}

.addr-line.short { width: 70%; }

.postmark {
  position: absolute;
  right: 10%;
  top: 16%;
  width: 74px;
  height: 74px;
  border-radius: 999px;
  border: 2px dashed rgba(20, 10, 14, 0.22);
  opacity: 0.45;
}

.postmark::after {
  content: "";
  position: absolute;
  inset: 16px;
  border-radius: 999px;
  border: 2px dashed rgba(20, 10, 14, 0.16);
}

.flap {
  position: absolute;
  left: 9px;
  right: 9px;
  top: 9px;
  height: 62%;
  border-top-left-radius: calc(var(--radius) - 9px);
  border-top-right-radius: calc(var(--radius) - 9px);

  background: linear-gradient(180deg, #fff, #ffe8f2);
  clip-path: polygon(0 0, 100% 0, 50% 75%);
  transform-origin: 50% 10%;
  transform: rotateX(0deg);
  transition: transform 650ms var(--ease);
  box-shadow: inset 0 -1px 0 rgba(0,0,0,0.06);
  pointer-events: none;
}

/* Letter collapsed */
.letter {
  position: absolute;
  left: 14%;
  right: 14%;
  top: 10%;
  height: 78%;
  border-radius: 18px;

  background:
    radial-gradient(900px 360px at 22% -20%, rgba(255, 171, 210, 0.24), rgba(255,255,255,0) 65%),
    radial-gradient(700px 420px at 110% 40%, rgba(120, 175, 255, 0.14), rgba(255,255,255,0) 60%),
    linear-gradient(180deg, var(--paper), var(--paper-2));
  box-shadow: var(--shadow-soft);

  transform: translateY(28%) scale(0.78);
  opacity: 0;

  transition:
    transform 920ms var(--ease),
    opacity 380ms var(--ease),
    left 920ms var(--ease),
    right 920ms var(--ease),
    top 920ms var(--ease),
    height 920ms var(--ease),
    border-radius 920ms var(--ease);
  z-index: 3;

  overflow: hidden;
}

.letter::before {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;

  background:
    radial-gradient(18px 18px at 14% 16%, rgba(255, 120, 210, 0.22), rgba(255,255,255,0) 70%),
    radial-gradient(16px 16px at 86% 20%, rgba(120, 175, 255, 0.18), rgba(255,255,255,0) 72%),
    radial-gradient(18px 18px at 18% 86%, rgba(120, 175, 255, 0.14), rgba(255,255,255,0) 74%),
    radial-gradient(20px 20px at 84% 86%, rgba(255, 120, 210, 0.18), rgba(255,255,255,0) 74%),

    radial-gradient(circle at 22% 34%, rgba(255,255,255,0.55) 0 1px, transparent 2px),
    radial-gradient(circle at 62% 22%, rgba(255,255,255,0.45) 0 1px, transparent 2px),
    radial-gradient(circle at 78% 54%, rgba(255,255,255,0.50) 0 1px, transparent 2px),
    radial-gradient(circle at 40% 72%, rgba(255,255,255,0.50) 0 1px, transparent 2px),
    radial-gradient(circle at 70% 82%, rgba(255,255,255,0.40) 0 1px, transparent 2px);
  background-size:
    auto, auto, auto, auto,
    180px 180px, 220px 220px, 200px 200px, 240px 240px, 210px 210px;
  opacity: 0.9;
  mix-blend-mode: screen;
}

.letter::after {
  content: "";
  position: absolute;
  left: 50%;
  top: 12px;
  transform: translateX(-50%) rotate(-2deg);
  width: 220px;
  height: 34px;
  border-radius: 10px;
  pointer-events: none;

  background:
    linear-gradient(90deg, rgba(255,255,255,0.40), rgba(255,255,255,0.12)),
    repeating-linear-gradient(
      45deg,
      rgba(255, 120, 210, 0.22) 0 8px,
      rgba(255,255,255,0.00) 8px 16px,
      rgba(120, 175, 255, 0.18) 16px 24px,
      rgba(255,255,255,0.00) 24px 32px
    );
  border: 1px solid rgba(255,255,255,0.35);
  box-shadow: 0 10px 26px rgba(0,0,0,0.10);
  opacity: 0;
  filter: blur(0.2px);
}

/* Inner layout */
.letter-inner {
  height: 100%;
  display: grid;
  grid-template-rows: auto 1fr;
  padding: calc(14px + var(--sat)) calc(16px + var(--sar)) calc(14px + var(--sab)) calc(16px + var(--sal));
  gap: 12px;
  position: relative;
  z-index: 1;
}

.who {
  display: grid;
  gap: 10px;
  padding: 12px 14px;
  border-radius: 14px;

  background:
    linear-gradient(180deg, rgba(255,255,255,0.78), rgba(255,255,255,0.58));
  border: 1px solid rgba(20,10,14,0.08);
  box-shadow:
    0 10px 22px rgba(0,0,0,0.08),
    inset 0 1px 0 rgba(255,255,255,0.65);
}

.row {
  display: grid;
  grid-template-columns: 54px 1fr;
  gap: 8px;
  align-items: baseline;
}

.label {
  font-size: 12px;
  opacity: 0.68;
  font-weight: 700;
}

.value {
  font-size: 15px;
  font-weight: 800;
  letter-spacing: -0.01em;
  text-align: left;
}

.message {
  padding: 0 14px 14px 14px;
  overflow: auto;
  -webkit-overflow-scrolling: touch;

  scrollbar-width: none;
}
.message::-webkit-scrollbar { width: 0; height: 0; }

.message p {
  margin: 0;
  font-size: 15px;
  line-height: var(--msg-line-height);
  opacity: 0.94;
  white-space: pre-wrap;

  max-width: 62ch;

  text-align: left;
  text-wrap: pretty;
  hyphens: auto;
  letter-spacing: 0.01em;
}

/* OPEN state */
.envelope.is-open .flap { transform: rotateX(165deg); }

/* Centered "reading card" */
.envelope.is-open .letter {
  position: fixed;
  z-index: 5;
  opacity: 1;

  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%) scale(1);

  width: min(92vw, 560px);
  height: min(78dvh, 720px);

  border-radius: 30px;

  box-shadow:
    0 26px 90px rgba(0,0,0,0.24),
    0 10px 28px rgba(0,0,0,0.14),
    inset 0 1px 0 rgba(255,255,255,0.78);

  outline: 1px solid rgba(255,255,255,0.34);

  animation: letterPopCentered 520ms var(--ease) both;
}

.envelope.is-open .letter::after { opacity: 0.92; }
.envelope.is-open .letter::before { animation: letterSparkle 6.4s linear infinite; }

@keyframes letterSparkle {
  0%   { transform: translate3d(0,0,0); opacity: 0.88; }
  50%  { transform: translate3d(-6px, 4px, 0); opacity: 0.98; }
  100% { transform: translate3d(0,0,0); opacity: 0.88; }
}

@keyframes letterPopCentered {
  0%   { transform: translate(-50%, -50%) scale(0.88); }
  55%  { transform: translate(-50%, -50%) scale(1.04); }
  100% { transform: translate(-50%, -50%) scale(1.00); }
}

/* De-emphasize envelope */
.envelope.is-open .airmail-border,
.envelope.is-open .envelope-front,
.envelope.is-open .envelope-back,
.envelope.is-open .shadow {
  filter: blur(1px);
  opacity: 0.65;
  transition: opacity 350ms var(--ease), filter 350ms var(--ease);
}

/* OPTIONAL: lined-paper background */
.envelope.is-open .message.is-lined {
  border-radius: 16px;
  padding: 10px 14px 14px 14px;

  background:
    linear-gradient(180deg, rgba(255,255,255,0.40), rgba(255,255,255,0.16)),
    repeating-linear-gradient(
      to bottom,
      rgba(255, 120, 210, 0.10) 0px,
      rgba(255, 120, 210, 0.10) 1px,
      rgba(255,255,255,0.0) 1px,
      rgba(255,255,255,0.0) var(--msg-line-step)
    );

  border: 1px solid rgba(255,255,255,0.28);
  box-shadow: inset 0 1px 0 rgba(255,255,255,0.55);
}

/* Tap to close under the opened letter */
.close-hint {
  position: fixed;
  left: 50%;
  transform: translateX(-50%);
  bottom: max(14px, var(--sab));
  width: min(92vw, 560px);
  text-align: center;

  margin: 0;
  padding: 8px 12px;
  font-size: 14px;
  opacity: 0;
  pointer-events: none;
  user-select: none;

  color: rgba(30, 18, 24, 0.85);
  background: rgba(255, 255, 255, 0.35);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
  border: 1px solid rgba(255,255,255,0.35);
  border-radius: 999px;

  transition: opacity 260ms var(--ease);
  z-index: 6;
}

/* When open, show it */
.stage.is-open .close-hint { opacity: 1; }

@media (hover: hover) {
  .envelope-btn:hover .envelope {
    transform: translateY(-2px);
    transition: transform 250ms var(--ease);
  }
}

@media (max-width: 360px) {
  .envelope.is-open .letter {
    width: 94vw;
    height: min(76dvh, 680px);
  }
  .close-hint {
    width: 94vw;
    font-size: 13.5px;
  }
  .message p { font-size: 14.5px; }

  .envelope.is-open .letter::after {
    width: 190px;
    height: 32px;
  }
}

@media (prefers-reduced-motion: reduce) {
  body { animation: none; }
  body::before, body::after { animation: none; }
  .flap, .letter { transition: none; }
  .bg-dim { transition: none; }
  .envelope.is-open .letter { animation: none; }
  .close-hint { transition: none; }
  .envelope.is-open .letter::before { animation: none; }
}

/* Screen reader only */
.sr-only {
  position: absolute !important;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0,0,0,0);
  white-space: nowrap;
  border: 0;
}
